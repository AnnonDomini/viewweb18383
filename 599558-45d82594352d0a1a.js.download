"use strict";(this.webpackChunk_msteams_convene=this.webpackChunk_msteams_convene||[]).push([[599558],{282088:(e,t,i)=>{var n;i.d(t,{G:()=>n}),function(e){e.APP_SWITCHER_CONFIRMATION_RENDERED="app-switcher-confirmation-renderer",e.AUDIO_DEVICE_SETTINGS_RENDERED="audio-device-settings-rendered",e.CALENDAR_HEADER_RENDERED="calendar-header-rendered",e.CALENDAR_VIEW_RENDERED="calendar-view-rendered",e.CALENDAR_SF_HEADER_RENDERED="calendar-sf-header-rendered",e.CALENDAR_SF_VIEW_RENDERED="calendar-sf-view-rendered",e.CALENDAR_SF_TRACKING_VIEW_RENDERED="calendar-sf-tracking-view-rendered",e.CALL_FORWARDING_SETTINGS_RENDERED="call-forwarding-settings-rendered",e.CALL_GROUP_OWNERS_RENDERED="call-group-owners-rendered",e.CALL_HISTORY_RENDERED="call-history-rendered",e.CALLS_APP_HISTORY_FETCH_STARTED="calls-app-history-fetch-started",e.CALLS_APP_HISTORY_FETCH_COMPLETED="calls-app-history-fetch-completed",e.CALLS_APP_SPEED_DIAL_FETCH_STARTED="calls-app-speed-dial-fetch-started",e.CALLS_APP_SPEED_DIAL_FETCH_COMPLETED="calls-app-speed-dial-fetch-completed",e.CALLING_SCREEN_RENDERED="calling-screen-rendered",e.CALLS_APP_RENDERED="calls-app-rendered",e.CAMPAIGN_VIEW_RENDERED="campaign-view-rendered",e.CHANNEL_DASHBOARD_HEADER_RENDERED="channel-dashboard-header-rendered",e.CHANNEL_DASHBOARD_VIEW_RENDERED="channel-dashboard-view-rendered",e.CHANNEL_HEADER_RENDERED="channel-header-rendered",e.CHANNEL_LIST_ITEMS_RENDERED="channel-list-items-rendered",e.CHAT_HEADER_BUTTONS_RENDERED="chat-header-buttons-rendered",e.CHAT_HEADER_TITLE_RENDERED="chat-header-title-rendered",e.CHAT_LIST_ITEMS_RENDERED="chat-list-items-rendered",e.COMPOSE_LAYOUT_LOADED="compose-layout-loaded",e.COMPOSE_LOADED="compose-loaded",e.COMMUNITIES_HEADER_RENDERED="communities-header-rendered",e.COMMUNITIES_MANAGE_VIEW_RENDERED="communities-manage-view-rendered",e.COMMUNITIES_JOIN_INVITE_VIEW_RENDERED="communities-join-invite-view-rendered",e.CONNECT_WITH_ANYONE_SHOWN="connect-with-anyone-shown",e.COURSE_TEAMS_MAIN_PANE_RENDERED="course-teams-main-pane-rendered",e.DIALPAD_RENDERED="dialpad-rendered",e.DISCOVER_SURFACE_FEED_RENDERED="discover-surface-feed-rendered",e.DISCOVER_SURFACE_HEADER_RENDERED="discover-surface-header-rendered",e.DISCOVER_SURFACE_VIEW_RENDERED="discover-surface-view-rendered",e.NO_FEED_GRAPHICS_RENDERED="no-feed-graphics-rendered",e.FEED_ITEM_NAVIGATION="feed-item-navigation",e.FEED_LIST_ITEMS_RENDERED="feed-list-items-rendered",e.HELP_APP_RENDERED="help-app-rendered",e.GUARDIANS_APP_RENDERED="guardians-app-rendered",e.MEET_APP_RENDERED="meet-app-rendered",e.MEETING_ROOM_FRONT_OF_ROOM_RENDERED="meeting-room-front-of-room-rendered",e.MEETING_ROOM_MAIN_SCREEN_RENDERED="meeting-room-main_screen-rendered",e.MEETING_ROOM_CONSOLE_UBAR_RENDERED="meeting-room-console-ubar-rendered",e.MEETING_ROOM_CONSOLE_ROSTER_RENDERED="meeting-room-console-roster-rendered",e.MEETING_ROOM_CONSOLE_MEETING_INFO_RENDERED="meeting-room-console-meeting-info-rendered",e.MEETING_ROOM_INCOMING_CALL_RENDERED="meeting-room-incoming-call-rendered",e.MESSAGE_REACTIONS_RENDERED="message-reactions-rendered",e.MESSAGES_RENDERED="messages-rendered",e.ONEUP_HEADER_RENDERED="oneup-header-rendered",e.ONEUP_RENDERED="oneup-rendered",e.PEOPLE_APP_RENDERED="people-app-rendered",e.PLATFORM_APP_CONTAINER_RENDERED="platform_app_container_rendered",e.PLATFORM_APP_FRAME_RENDERED="platform_app_frame_rendered",e.PLATFORM_APP_FRAME_CONTENT_RENDERED="platform_app_frame_content_rendered",e.P2P_FILES_LIST_VIEW_RENDERED="p2p_files_list_view_rendered",e.PRESENCES_RENDERED="presences-rendered",e.QUEUES_APP_DIALPAD_RENDERED="queues-app-dialpad-rendered",e.QUEUES_APP_HEADER_RENDERED="queues-app-header-rendered",e.QUEUES_APP_CENTER_RENDERED="queues-app-center-rendered",e.QUEUES_APP_QUEUE_MANAGEMENT_RENDERED="queues-app-queue-management-rendered",e.QUEUES_APP_QUEUE_MANAGEMENT_PEOPLE_TAB_RENDERED="queues-app-queue-management-people-tab-rendered",e.QUEUES_APP_QUEUE_MANAGEMENT_CALLS_TAB_RENDERED="queues-app-queue-management-calls-tab-rendered",e.QUEUES_APP_QUICK_ACCESS_RENDERED="queues-app-quick-access-rendered",e.QUEUES_APP_REALTIME_PERFORMANCE_RENDERED="queues-app-realtime-performance-rendered",e.QUEUES_APP_STATS_RENDERED="queues-app-stats-rendered",e.SEARCH_RESULTS_RENDERED="search-results-rendered",e.SETTINGS_RENDERED="settings-rendered",e.SHARE_PAGE_RENDERED="share-page-rendered",e.SINGLE_TEAM_VIEW_LEFT_RAIL_LOADED="single-team-view-left-rail-loaded",e.COACH_REPORT_VIEW_RENDERED="coach-report-view-rendered",e.SPEED_DIAL_RENDERED="speed-dial-rendered",e.TEAM_DASHBOARD_HEADER_RENDERED="team-dashboard-header-rendered",e.TEAM_DASHBOARD_VIEW_RENDERED="team-dashboard-view-rendered",e.TEAMS_DASHBOARD_HEADER_RENDERED="teams-dashboard-header-rendered",e.TEAMS_DASHBOARD_VIEW_RENDERED="teams-dashboard-view-rendered",e.TEAMS_GRID_VIEW_HEADER_RENDERED="teams-grid-view-header-rendered",e.TEAMS_GRID_VIEW_RENDERED="teams-grid-view-rendered",e.VIRTUAL_LIST_RENDER_BUFFER_FILLED="virtual-list-render-buffer-filled",e.USER_ONBOARDING_TO_TEAM_VIEW_RENDERED="user-onboarding-to-team-view-rendered",e.USER_ONBOARDING_HEADER_RENDERED="user-onboarding-header-rendered"}(n||(n={}))},982190:(e,t,i)=>{var n;i.d(t,{x:()=>n}),function(e){e.Perf="perf",e.Scenario="scenarions",e.Logging="loggingns",e.Heartbeat="heartbeatns",e.Http="httpns",e.UserBI="userbins",e.Endpoint="endpointns",e.ClickStream="clickstreamns"}(n||(n={}))},137021:(e,t,i)=>{i.d(t,{ip:()=>c,Yx:()=>u,MI:()=>m,P3:()=>p,aA:()=>E,Rr:()=>v});var n=i(781662),r=i(870017),a=i(969939),o=i(982190),s=i(300426),d=i(974509);const l="heartbeat";class c{constructor(){this.initialized=!1,this.logger=a.h.default,this.eventDecoratorCallbacks=[],this.flush=()=>this.telemetryProvider.flush(),this.telemetryProvider=(0,n.G)(),(0,r.Y)((()=>{this.initialized=!1,this.eventDecoratorCallbacks=[]}))}get sessionId(){return this.telemetryProvider.sessionId}initialize(e,t=a.h.default){this.initialized||(this.consoleLogger=e,this.consoleLogger.debug("TelemetrySender initialized."),this.logger=t,this.initialized=!0)}static getInstance(){return this.telemetrySender||(this.telemetrySender=new c),this.telemetrySender}registerEventDecorator(e){this.eventDecoratorCallbacks.push(e)}sendTelemetry(e,t,i={},n,r,a,l=""){if(!this.initialized)return;t=t.replace(/\-/g,"_").toLowerCase();const c=e===o.x.Http?i.resultCode:e===o.x.Endpoint&&i.result&&d.qb[i.result]?d.qb[i.result].toString():e===o.x.Endpoint&&i.hasInnerError?"fail":"success",u=s.H.getInstance().getSampleRate(e,null!=a?a:t,c);if(u===s.k)return;this.decorateEvent(t,i);const m=this.telemetryProvider.createEvent(e,t,i,n,r,a);m.setProperty("sampleRate",u),this.telemetryProvider.logEvent(this.logger,m,l)}sendScenarioEvent(e,t,i,n,r,a=""){var d;if(!this.initialized)return;const l=e.replace(/\-/g,"_"),c=o.x.Scenario;let u=s.H.getInstance().getSampleRate(c,l,i["Scenario.Status"]);if("Scenario.CrossClientMode"in t&&(u=null!==(d=s.H.getInstance().getCrossClientScenarioSampleRate(i["Scenario.Mode"]))&&void 0!==d?d:u),u===s.k)return;this.decorateEvent(l,t);const m=Object.assign(Object.assign({},i),t),p=this.telemetryProvider.createEvent(c,e,m,n,r);p.setProperty("sampleRate",u),this.telemetryProvider.logEvent(this.logger,p,a)}sendHeartbeatEvent(e){if(!this.initialized)return;const t=o.x.Heartbeat;this.decorateEvent(l,e);const i=this.telemetryProvider.createEvent(t,l,e);this.telemetryProvider.logEvent(this.logger,i,void 0)}sendLoggingEvent(e,t,i,n,r,a){if(!this.initialized)return;e=e.replace(/\-/g,"_").toLowerCase();const d=o.x.Logging,l=s.H.getInstance().getSampleRate(d,i,t.logLevel);if(l===s.k)return;this.decorateEvent(e,t);const c=this.telemetryProvider.createEvent(d,e,t,r,a,i);c.setProperty("sampleRate",l),this.telemetryProvider.logEvent(this.logger,c,n)}decorateEvent(e,t){this.eventDecoratorCallbacks.forEach((i=>i(e,t)))}}function u(e,t,i,n,r,a=""){c.getInstance().sendScenarioEvent(e,t,i,n,r,a)}function m(e,t,i,n,r,a=""){c.getInstance().sendLoggingEvent(e,t,i,a,n,r)}function p(e,t,i,n,r,a,o=""){c.getInstance().sendTelemetry(e,t,i,n,r,a,o)}function E(e){c.getInstance().sendHeartbeatEvent(e)}function v(e){c.getInstance().registerEventDecorator(e)}},586990:(e,t,i)=>{i.d(t,{K:()=>N});var n,r=i(850402);!function(e){e.p720="720p",e.p1080="1080p",e.p2k="2k",e.p4k="4k",e.unkown="unkown"}(n||(n={}));const a=2073600,o=3686400,s=8294400;function d(e){var t,i,d;return(0,r.__awaiter)(this,void 0,void 0,(function*(){const r={Perf_Screen:void 0};let l;const c=e.screen.availWidth*(null===(t=e.screen)||void 0===t?void 0:t.availHeight);return l=c<a?n.p720:c>=a&&c<o?n.p1080:c>=o&&c<s?n.p2k:c>=s?n.p4k:n.unkown,r.Perf_Screen={width:null===(i=e.screen)||void 0===i?void 0:i.availWidth,height:null===(d=e.screen)||void 0===d?void 0:d.availHeight,resolution:l,dpr:e.devicePixelRatio},Promise.resolve(r)}))}var l=i(354571),c=i(50805),u=i(132756),m=i(137021),p=i(375823),E=i(422325),v=i(778161),h=i(275742);class S{constructor(e,t,i){this.hostCommunicationService=t,this.trackAppCountOnly=i,this.uuidToAppIdMap={},this.cmsObjects=[],this.logger=e.newLogger("PlatformAppsManagementService","core-services-telemetry")}getTelemetry(e){return this.getPlatformAppsStats(e)}getAppsPerfMetrics(){return(0,r.__awaiter)(this,void 0,void 0,(function*(){if(this.hostCommunicationService){const e=yield(0,E.K)(this.hostCommunicationService,!0);return this.getPlatformAppsStats(e,!0)}}))}addCacheManagementService(e){var t,i;return this.cmsObjects.find((t=>t===e))?(null===(i=(t=this.logger).errorToTelemetry)||void 0===i||i.call(t,"addCacheManagementService: cms exists in appManagementService","platform_app_caching_cms_exists_in_app_management_service",void 0,!0),!1):(this.cmsObjects.push(e),!0)}removeCacheManagementService(e){return this.cmsObjects.splice(this.cmsObjects.indexOf(e),1),!0}addApp(e,t,i){var n,r;return this.uuidToAppIdMap.hasOwnProperty(e)?(null===(r=(n=this.logger).errorToTelemetry)||void 0===r||r.call(n,"addApp: App exists in appManagementService","platform_app_exists_in_app_management_service",{"App.Id":t},!0),!1):(this.uuidToAppIdMap[e]={appId:t,managedByCache:i},!0)}removeApp(e){var t,i;return this.uuidToAppIdMap[e]?(delete this.uuidToAppIdMap[e],!0):(null===(i=(t=this.logger).errorToTelemetry)||void 0===i||i.call(t,"removeApp: App is not in uuid map","platform_app_missing_in_uuid_map",void 0,!0),!1)}removeLeastRecentlyUsedApp(){let e;for(const t of this.cmsObjects){const i=t.getLeastRecentlyUsedApp();i&&(i.uuid&&i.timeInCache&&(void 0===e||i.timeInCache<e.timeInCache)&&(e={frameUuid:i.uuid,cmsObject:t,timeInCache:i.timeInCache}))}if(null==e?void 0:e.frameUuid){const t=this.uuidToAppIdMap[e.frameUuid];(null==t?void 0:t.appId)&&e.cmsObject.removeByAms(null==t?void 0:t.appId)}}findProcessInfo(e,t){if(!t)return;const i=e.processes.find((e=>e.processId===t));return i?{workingSetSize:i.workingSetSizeKB,commitSize:i.commitSizeKB,cpuCycleTime:i.cpuCycleTime}:void 0}computeSizeOfFrames(e){const{memoryMetrics:t,processVisitedMap:i,isActiveApp:n,appsStats:r,perAppData:a,frames:o,treeLevel:s}=e;for(const d of o){d.platformFrameUuid&&(n?r.activeAppsCount+=1:r.cachedAppsCount+=1);const o=this.findProcessInfo(t,d.processId);if(!o)return;const l=o.workingSetSize||0,c=o.commitSize||0;d.processId&&!i[d.processId]&&(i[d.processId]=d,this.addAppStatsInfo(n,l,c,r)),a.totalWorkingSetSizeKB+=l,a.totalCommitSizeKB+=c,a.maxCpuCycleTime=Math.max(a.maxCpuCycleTime,o.cpuCycleTime),a.frameInfo.push({processId:d.processId,workingSetSizeKB:o.workingSetSize,cpuCycleTime:o.cpuCycleTime,treeLevel:s}),this.computeSizeOfFrames(Object.assign(Object.assign({},e),{frames:d.frames,treeLevel:s+1}))}}isActiveApp(e){let t=!1;for(const i of this.cmsObjects){const n=i.isAppCached(e);if(void 0!==n&&(t=!n,t))break}return t}getPlatformAppsStats(e,t){const i={activeWorkingSetSizeKB:0,cachedWorkingSetSizeKB:0,activeCommitSizeKB:0,cachedCommitSizeKB:0,activeAppsCount:0,cachedAppsCount:0,appsPlatformStats:[]},n={windows:e.windows,processVisitedMap:{},memoryMetrics:e,appsStats:i,includeFrameUuid:t};if(this.trackAppCountOnly){const{cachedAppsCount:e,activeAppsCount:t}=this.processCachedAppCount();return Object.assign(Object.assign({},i),{cachedAppsCount:e,activeAppsCount:t})}return this.processMemoryInformation(Object.assign(Object.assign({},n),{computeActiveApps:!0})),this.processMemoryInformation(Object.assign(Object.assign({},n),{computeActiveApps:!1})),i}addAppStatsInfo(e,t,i,n){e?(n.activeWorkingSetSizeKB+=t,n.activeCommitSizeKB+=i):(n.cachedWorkingSetSizeKB+=t,n.cachedCommitSizeKB+=i)}processCachedAppCount(){let e=0,t=0;const i=Object.keys(this.uuidToAppIdMap);for(const n of i){const i=this.uuidToAppIdMap[n];!(null==i?void 0:i.managedByCache)||this.isActiveApp(n)?e+=1:t+=1}return{cachedAppsCount:t,activeAppsCount:e}}processMemoryInformation(e){var t;const{windows:i,computeActiveApps:n,appsStats:r,memoryMetrics:a,processVisitedMap:o,includeFrameUuid:s}=e;for(const e of i)for(const i of e.frames){if(!i.platformFrameUuid)continue;const d=this.uuidToAppIdMap[i.platformFrameUuid],l=!(null==d?void 0:d.managedByCache)||this.isActiveApp(i.platformFrameUuid);if(l===!n)continue;const c={windowId:e.windowId,isCached:!l,totalWorkingSetSizeKB:0,totalCommitSizeKB:0,maxCpuCycleTime:0,frameInfo:[],appId:null!==(t=null==d?void 0:d.appId)&&void 0!==t?t:"",platformFrameUuid:s?i.platformFrameUuid:void 0};this.computeSizeOfFrames({frames:[i],appsStats:r,memoryMetrics:a,perAppData:c,isActiveApp:l,processVisitedMap:o,treeLevel:0}),r.appsPlatformStats.push(c)}}}var _=i(382433),g=i(101027);class f{constructor(e,t,i){this.leakDetectorService=t,this.fallbackHost=i,this.logger=e.newLogger("StyleMetricsService","core-services-telemetry"),this.currentStyles=this.getCurrentStyles()}getTelemetry(){const e=this.getCurrentStyles(),t=e-this.currentStyles;return t>0&&this.logger.warn(`Style count increased by ${t} since last heartbeat. New Style count: ${e}`),this.currentStyles=e,{Style_Count:e,Style_Delta:t}}getPrimaryWindow(){var e,t;const i=null===(e=this.leakDetectorService)||void 0===e?void 0:e.getReachableObjects(g.I.UnwrappedWindow);return i&&0!==i.size?Array.from(null===(t=this.leakDetectorService)||void 0===t?void 0:t.getReachableObjects(g.I.UnwrappedWindow)).find((e=>{var t;return(null===(t=e.windowLeakInfo)||void 0===t?void 0:t.windowLeakInfoViewportContext)===_.R.primary})):this.fallbackHost}getCurrentStyles(){const e=this.getPrimaryWindow();return e?Array.from(e.document.styleSheets).filter((e=>!e.href)).flatMap((e=>Array.from(e.cssRules))).length:0}}const k=[l.pk.LongInactive],R=e=>k.includes(e);class N{constructor(e){this.context=e,this.isRunning=!1,this.timeouts={},this.lastBeatTimes={},this.intervals={},this.granularNativeMetrics=[],this.granularWorkerMetrics=[],this.packedCallingData=new Map,this.peakWorkingSetByProcess=new Map,this.peakUsedJSHeapSize=0,this.granularJSHeapMetrics=[],this.getHeartbeatStandardInterval=()=>{var e,t;return null!==(t=null===(e=this._configuration)||void 0===e?void 0:e.intervalInSeconds)&&void 0!==t?t:Number.MAX_SAFE_INTEGER},this.getHeartbeatInterval=e=>{var t,i,n,r,a;const o=this.getHeartbeatStandardInterval(),s=null!==(i=null===(t=this._configuration)||void 0===t?void 0:t.maxIntervalInSeconds)&&void 0!==i?i:o,d=Math.max(1,null!==(r=null===(n=this._configuration)||void 0===n?void 0:n.delayFactor)&&void 0!==r?r:1),l=null===(a=this.context.clientState)||void 0===a?void 0:a.getState();return l&&R(l)?Math.min(s,Math.max(e,o)*d):o},this.getMemorySubInterval=()=>{var e,t,i;return null!==(i=null===(t=null===(e=this._configuration)||void 0===e?void 0:e.memoryMetricsCollection)||void 0===t?void 0:t.collectionIntervalInSeconds)&&void 0!==i?i:Number.MAX_SAFE_INTEGER},this.logger=e.loggerFactory.newLogger("Heartbeat","core-services-telemetry");const{enableAppCountTracking:t}=e.coreSettings.get(c.J.Extensibility);this.platformAppsManagementService=new S(e.loggerFactory,e.hostCommunicationService,!!t),this.styleMetricsService=new f(e.loggerFactory,e.leakDetectorService,e.windowProvider)}static getInstance(){return N.instance}get configuration(){return this._configuration}getPlatformAppsService(){return this.platformAppsManagementService}start(){return(0,r.__awaiter)(this,void 0,void 0,(function*(){N.instance||(N.instance=this,this.logger.debug("Starting the monitor..."),this.initializedTime=Date.now(),this.subscribeToCoreSettings(),this.subscribeToClientState(),yield this.registerScenarios())}))}isHeartbeatMonitorRunning(){return this.isRunning}getMemoryData(){var e,t;return(null===(t=null===(e=this._configuration)||void 0===e?void 0:e.memoryMetricsCollection)||void 0===t?void 0:t.enabled)?this.getAverageMemoryMetrics():{}}collectData(){return(0,r.__awaiter)(this,void 0,void 0,(function*(){const e=this.getActions().map((e=>(0,r.__awaiter)(this,void 0,void 0,(function*(){var t,i;try{return yield e()}catch(n){return null===(i=(t=this.logger).errorToTelemetry)||void 0===i||i.call(t,`call to function '${e}' failed in heartbeat monitor.`,"fundamentals_performance_heartbeat_monitor"),{}}}))));return Object.assign.apply(Object,yield Promise.all(e))}))}collectCallingData(e,t){var i,n;const{enableCallingCDLTrackingNS:r}=this.context.coreSettings.get(c.J.Calling)||{};if(r){const e=JSON.parse(t),n={cdlData:null===(i=this.context.graphqlOpsCountService)||void 0===i?void 0:i.getLatestDataAndClear()},r=Object.assign(e,n);t=JSON.stringify(r)}this.packedCallingData.set(e,(null!==(n=this.packedCallingData.get(e))&&void 0!==n?n:[]).concat(t))}getActions(){var e,t,i,n,r,a,o,s,l,u,m,p,E,v,h,S,_,g,f,k,R,N,D,A,I;const C=[];(null===(t=null===(e=this._configuration)||void 0===e?void 0:e.memoryMetricsCollection)||void 0===t?void 0:t.enabled)&&C.push(this.getAverageMemoryMetrics.bind(this)),(null===(n=null===(i=this._configuration)||void 0===i?void 0:i.elapsedTimeTracking)||void 0===n?void 0:n.enabled)&&C.push(this.getElapsedTime.bind(this)),(null===(a=null===(r=this._configuration)||void 0===r?void 0:r.screenInfoCollection)||void 0===a?void 0:a.enabled)&&C.push(d.bind(this,this.context.windowProvider)),(null===(s=null===(o=this._configuration)||void 0===o?void 0:o.ariMetricsCollection)||void 0===s?void 0:s.enabled)&&C.push(this.getAriMetrics.bind(this)),(null===(u=null===(l=this._configuration)||void 0===l?void 0:l.dataClientMetricsCollection)||void 0===u?void 0:u.enabled)&&C.push(this.getDataClientMetrics.bind(this)),(null===(p=null===(m=this._configuration)||void 0===m?void 0:m.windowMetricsCollection)||void 0===p?void 0:p.enabled)&&C.push(this.getWindowMetrics.bind(this)),(null===(v=null===(E=this._configuration)||void 0===E?void 0:E.clientStateMetricsCollection)||void 0===v?void 0:v.enabled)&&C.push(this.getClientStateMetrics.bind(this)),(null===(S=null===(h=this._configuration)||void 0===h?void 0:h.OLDMetricsCollection)||void 0===S?void 0:S.enabled)&&C.push(this.getObjectLeakDetectorMetrics.bind(this));const{enableCallingDataCollectionInHeartbeatConfig:T}=(null===(_=this.context.coreSettings)||void 0===_?void 0:_.get(c.J.Calling))||{};return T&&(null===(f=null===(g=this._configuration)||void 0===g?void 0:g.callingDataCollection)||void 0===f?void 0:f.enabled)&&C.push(this.getCallingData.bind(this)),(null===(R=null===(k=this._configuration)||void 0===k?void 0:k.graphqlStoreMetricsCollection)||void 0===R?void 0:R.enabled)&&C.push(this.getGraphQLStoreMetrics.bind(this)),(null===(D=null===(N=this._configuration)||void 0===N?void 0:N.platformAppMetricsCollection)||void 0===D?void 0:D.enabled)&&C.push(this.getPlatformAppsMetrics.bind(this)),(null===(I=null===(A=this._configuration)||void 0===A?void 0:A.styleMetricsCollection)||void 0===I?void 0:I.enabled)&&C.push(this.getStyleMetrics.bind(this)),C}stopHeartbeat(){this.isRunning&&this.logger.debug("stopping heartbeat monitor"),Object.keys(this.timeouts).forEach((e=>{this.context.windowProvider.clearTimeout(this.timeouts[e])})),this.timeouts={},this.isRunning=!1}subscribeToCoreSettings(){const e=this.context.coreSettings.getObservable(c.J.Telemetry);let t=this.context.coreSettings.get(c.J.Telemetry).heartbeatConfiguration;e.subscribe((e=>{var i,n,r,a,o,s;const{enableHeartbeatMonitor:d,heartbeatConfiguration:l}=e;l?(this._configuration=l,this.logger.debug("Configuration loaded...",this._configuration)):null===(n=(i=this.logger).errorToTelemetry)||void 0===n||n.call(i,"'heartbeatConfiguration' not found.","fundamentals_performance_heartbeat_monitor"),d?(this.startHeartbeat(),(null===(a=null===(r=this._configuration)||void 0===r?void 0:r.memoryMetricsCollection)||void 0===a?void 0:a.enabled)||(this.context.windowProvider.clearTimeout(this.timeouts.memory),this.timeouts.memory=void 0)):(this._configuration=void 0,this.stopHeartbeat()),(null===(o=this._configuration)||void 0===o?void 0:o.intervalInSeconds)&&(null==t?void 0:t.intervalInSeconds)!==(null===(s=this._configuration)||void 0===s?void 0:s.intervalInSeconds)&&this.overrideNextBeat(),t=this._configuration}))}startHeartbeat(){!this.isRunning&&this.logger.debug("starting heartbeat monitor"),this.scheduleNextTimeout("heartbeat",this.isRunning?this.getHeartbeatInterval(0):Math.min(30,this.getHeartbeatInterval(0)),this.beat.bind(this),this.getHeartbeatInterval,!1),this.scheduleNextTimeout("memory",this.isRunning?this.getMemorySubInterval():Math.min(25,this.getMemorySubInterval()),this.collectGranularMemoryAndJSHeapData.bind(this),this.getMemorySubInterval,!1),this.isRunning=!0}overrideNextBeat(){var e,t;if(!this.isRunning)return;const i=this.getHeartbeatInterval(0)*u.B.second,n=Date.now(),r=((null!==(t=null!==(e=this.lastBeatTimes.heartbeat)&&void 0!==e?e:this.initializedTime)&&void 0!==t?t:n)+i-n)/u.B.second;this.scheduleNextTimeout("heartbeat",r>0?r:0,this.beat.bind(this),this.getHeartbeatInterval,!0)}subscribeToClientState(){const{clientState:e}=this.context;if(!e)return void this.context.windowProvider.setTimeout((()=>this.subscribeToClientState()),100);this.logger.log("Client state is available, preparing subscription");const t=e.observe();let i=e.getState();t.subscribe({next:e=>{R(i)&&!R(e)&&this.overrideNextBeat(),i=e}})}scheduleNextTimeout(e,t=Number.MAX_SAFE_INTEGER,i,n,a){const o=t*u.B.second;0<=o&&o<2147483647&&(a&&this.timeouts[e]&&(this.context.windowProvider.clearTimeout(this.timeouts[e]),this.timeouts[e]=void 0),this.timeouts[e]||(this.intervals[e]=t,this.timeouts[e]=this.context.windowProvider.setTimeout((()=>(0,r.__awaiter)(this,void 0,void 0,(function*(){var r,a;this.timeouts[e]=void 0;try{yield i()}catch(e){null===(a=(r=this.logger).errorToTelemetry)||void 0===a||a.call(r,`call to function '${i}' failed in heartbeat monitor.`,"fundamentals_performance_heartbeat_monitor")}finally{this.lastBeatTimes[e]=Date.now(),this.scheduleNextTimeout(e,n(t),i,n,!1)}}))),o)))}beat(){return(0,r.__awaiter)(this,void 0,void 0,(function*(){const e=yield this.collectData();(0,m.aA)(e)}))}getElapsedTime(){const e=Date.now(),t=this.initializedTime||e;return{elapsed:Math.floor((e-t)/u.B.second)}}getAverageMemoryMetrics(){const e=[];if(this.granularNativeMetrics.length){const t=new Map(this.peakWorkingSetByProcess.entries());this.peakWorkingSetByProcess.clear(),this.granularNativeMetrics.reduce(((e,t)=>{var i;for(const n of t){const{processId:t}=n;e.set(t,(null!==(i=e.get(t))&&void 0!==i?i:[]).concat(n))}return e}),new Map).forEach(((i,n)=>{var r;this.peakWorkingSetByProcess.set(n,null!==(r=t.get(n))&&void 0!==r?r:0);const a=(0,h.meanBy)(i,(e=>e.workingSetSizeKB)),o=(0,h.meanBy)(i,(e=>e.commitSizeKB)),s={processId:n,name:i[0].name,type:i[0].type,utilitySubType:i[0].utilitySubType,embeddedBrowserWebView:i[0].embeddedBrowserWebView,cpuCycleTime:i[0].cpuCycleTime,workingSetSizeKB:isNaN(a)?void 0:Math.round(a),commitSizeKB:isNaN(o)?void 0:Math.round(o)};e.push(s)}))}const t=[];this.granularWorkerMetrics.length&&this.granularWorkerMetrics.reduce(((e,t)=>{var i;for(const n of t){const{targetSessionId:t}=n;e.set(t,(null!==(i=e.get(t))&&void 0!==i?i:[]).concat(n))}return e}),new Map).forEach(((e,i)=>{const n=(0,h.meanBy)(e,(e=>e.totalSizeKB)),r=(0,h.meanBy)(e,(e=>e.usedSizeKB)),a={targetSessionId:i,type:e[0].type,subType:e[0].subType,totalSizeKB:isNaN(n)?void 0:Math.round(n),usedSizeKB:isNaN(r)?void 0:Math.round(r)};t.push(a)}));const i=(0,p.Mv)(e,this.peakWorkingSetByProcess,this.mainRendererProcessId),n=(0,p.tC)(t);let r={};if(this.granularJSHeapMetrics.length){const e={jsHeapSizeLimit:Math.round((0,h.meanBy)(this.granularJSHeapMetrics,(e=>e.jsHeapSizeLimit||0))),totalJSHeapSize:Math.round((0,h.meanBy)(this.granularJSHeapMetrics,(e=>e.totalJSHeapSize||0))),usedJSHeapSize:Math.round((0,h.meanBy)(this.granularJSHeapMetrics,(e=>e.usedJSHeapSize||0)))};r=(0,p.RQ)(e,this.peakUsedJSHeapSize)}return Object.assign(Object.assign(Object.assign({},i),n),r)}getAriMetrics(){const e={Perf_Ari:""};if(this.context.appResponsivenessService){const t=this.context.appResponsivenessService.getTelemetry();e.Perf_Ari=t}return e}getDataClientMetrics(){const e={Perf_ApolloCacheStats:void 0};if(this.context.dataClientTrackingService){const t=this.context.dataClientTrackingService.getTelemetry();e.Perf_ApolloCacheStats=t}return e}getWindowMetrics(){const e={Perf_WindowStats:void 0};if(this.context.windowTrackerService){const t=this.context.windowTrackerService.getTelemetry();e.Perf_WindowStats=t}return e}getObjectLeakDetectorMetrics(){const e={};if(this.context.leakDetectorService){const t=this.context.leakDetectorService.getTelemetry();if(t){const{counts:i,leakStats:n,leaks:r,countsRecord:a,hasWindowLeak:o,hasApolloLeak:s}=t;e.Perf_OLDStats=i,e.Perf_LeakStats=n,e.Perf_Leaks=r,e.Perf_LeaksRecord=a,e.Perf_Leaks_HasWindowLeak=o,e.Perf_Leaks_HasApolloLeak=s}}return e}getClientStateMetrics(){const e={Perf_IsUserInCall:void 0};if(this.context.clientState){const t=this.context.clientState.getState()===l.pk.VeryActive;e.Perf_IsUserInCall=t}return e}getCallingData(){const e={Perf_Calling_Data:void 0};return this.packedCallingData.forEach((t=>{e.Perf_Calling_Data?e.Perf_Calling_Data.push(...t):e.Perf_Calling_Data=t})),this.packedCallingData.clear(),e}getGraphQLStoreMetrics(){const e={};return this.context.graphqlStoreStatsReporterService&&(e.Perf_GraphQLStoreStats=this.context.graphqlStoreStatsReporterService.getTelemetry()),e}getPlatformAppsMetrics(){let e={};if(this.lastMemoryMetrics){const t=this.platformAppsManagementService.getTelemetry(this.lastMemoryMetrics);e={Perf_PlatformApps_Active_WorkingSet:t.activeWorkingSetSizeKB,Perf_PlatformApps_Cached_WorkingSet:t.cachedWorkingSetSizeKB,Perf_PlatformApps_Active_Commit_Size:t.activeCommitSizeKB,Perf_PlatformApps_Cached_Commit_Size:t.cachedCommitSizeKB,Perf_PlatformApps_Count_CachedApps:t.cachedAppsCount,Perf_PlatformApps_Count_ActiveApps:t.activeAppsCount,Perf_PlatformApps_Stats:t.appsPlatformStats}}return e}getStyleMetrics(){return this.styleMetricsService.getTelemetry()}collectGranularMemoryAndJSHeapData(){var e,t,i,n;return(0,r.__awaiter)(this,void 0,void 0,(function*(){const r=null!==(e=this.intervals.heartbeat)&&void 0!==e?e:this.getHeartbeatStandardInterval(),a=Math.max(Math.round(r/this.getMemorySubInterval()),1)||1;if(this.context.hostCommunicationService){const e=yield(0,E.K)(this.context.hostCommunicationService,(null===(i=null===(t=this._configuration)||void 0===t?void 0:t.workerMetricsCollection)||void 0===i?void 0:i.enabled)||!1);this.lastMemoryMetrics=e,this.granularNativeMetrics=this.granularNativeMetrics.concat([e.processes]).slice(-a),this.granularWorkerMetrics=this.granularWorkerMetrics.concat([e.workers]).slice(-a);const r=[];for(const t of e.processes){const{processId:e,type:i}=t,n=this.peakWorkingSetByProcess.get(e);this.peakWorkingSetByProcess.set(e,Math.max(n||0,t.workingSetSizeKB||0)),"renderer"===i.toLowerCase()&&r.push(t)}this.mainRendererProcessId=this.mainRendererProcessId&&r.find((e=>e.processId===this.mainRendererProcessId))?this.mainRendererProcessId:null===(n=r.sort(((e,t)=>{var i,n;return(null!==(i=t.workingSetSizeKB)&&void 0!==i?i:0)-(null!==(n=e.workingSetSizeKB)&&void 0!==n?n:0)}))[0])||void 0===n?void 0:n.processId}else this.logger.error("Invalid hostCommunicationService, cannot get metrics from Desktop");if(this.context.windowProvider){const e=(0,v.P)(this.context.windowProvider);this.peakUsedJSHeapSize=Math.max(this.peakUsedJSHeapSize,e.usedJSHeapSize||0),this.granularJSHeapMetrics=this.granularJSHeapMetrics.concat(e).slice(-a)}}))}registerScenarios(){return(0,r.__awaiter)(this,void 0,void 0,(function*(){if(this.context.hostCommunicationService){const e=yield this.context.hostCommunicationService.loadModule("heartbeat");if(null==e?void 0:e.registerForScenarioStart)try{e.registerForScenarioStart((e=>{}))}catch(e){this.logger.error("Failed to register for listening to host scenarios starting")}if(null==e?void 0:e.registerForScenarioStop)try{e.registerForScenarioStop((e=>{}))}catch(e){this.logger.error("Failed to register for listening to host scenarios stopping")}}}))}}N.instance=void 0},534380:(e,t,i)=>{i.d(t,{E:()=>n});const n={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"DataClientPlatformAppButtonQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"appId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"appButtonResult"},arguments:[{kind:"Argument",name:{kind:"Name",value:"appId"},value:{kind:"Variable",name:{kind:"Name",value:"appId"}}}],directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"appId"}},{kind:"Field",name:{kind:"Name",value:"action"}}]}}]}}]}},743107:(e,t,i)=>{i.d(t,{i:()=>n});const n={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"DataClientPlatformBackButtonHandlerStateQuery"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"backButtonHandlerState"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"registered"}}]}}]}}]}},858453:(e,t,i)=>{i.d(t,{L:()=>n});const n={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"DataClientPlatformChangeSettingsQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"id"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"changeSettingsResult"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"id"}}}],directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"status"}},{kind:"Field",name:{kind:"Name",value:"appId"}},{kind:"Field",name:{kind:"Name",value:"tabId"}}]}}]}}]}},210439:(e,t,i)=>{i.d(t,{N:()=>n});const n={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"DataClientPlatformChangeSettingsTriggerQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"id"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"changeSettingsTriggerResult"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"id"}}}],directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"appId"}},{kind:"Field",name:{kind:"Name",value:"tabId"}},{kind:"Field",name:{kind:"Name",value:"message"}}]}}]}}]}},691584:(e,t,i)=>{i.d(t,{O:()=>n});const n={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"DataClientPlatformLocalFrameContextQuery"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"localFrameContext"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"threadId"}},{kind:"Field",name:{kind:"Name",value:"messageId"}},{kind:"Field",name:{kind:"Name",value:"tabId"}},{kind:"Field",name:{kind:"Name",value:"websiteUrl"}},{kind:"Field",name:{kind:"Name",value:"contentUrl"}}]}}]}}]}},324029:(e,t,i)=>{i.d(t,{i:()=>n});const n={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"mapCoordinateResult"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"mapCoordinateResult"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"latitude"}},{kind:"Field",name:{kind:"Name",value:"longitude"}},{kind:"Field",name:{kind:"Name",value:"locationApiError"}}]}}]}}]}},56818:(e,t,i)=>{i.d(t,{n:()=>n});const n={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"messageToChildResult"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"appId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"messageToChildResult"},arguments:[{kind:"Argument",name:{kind:"Name",value:"appId"},value:{kind:"Variable",name:{kind:"Name",value:"appId"}}}],directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"appId"}},{kind:"Field",name:{kind:"Name",value:"message"}}]}}]}}]}},516102:(e,t,i)=>{i.d(t,{a:()=>n});const n={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"selectMediaResult"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"selectMediaResult"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"selectMediaError"}},{kind:"Field",name:{kind:"Name",value:"mediaUrls"}}]}}]}}]}},933246:(e,t,i)=>{i.d(t,{k:()=>n});const n={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"selectPeoplePickerResult"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"selectPeoplePickerResult"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"objectId"}},{kind:"Field",name:{kind:"Name",value:"displayName"}},{kind:"Field",name:{kind:"Name",value:"email"}}]}}]}}]}},607036:(e,t,i)=>{i.d(t,{F:()=>n});const n={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"showLocationResponse"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"showLocationResponse"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}]}]}}]}},47101:(e,t,i)=>{i.d(t,{sR:()=>n});const n={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"taskModuleResult"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"taskModuleResult"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"card"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"appIcon"}},{kind:"Field",name:{kind:"Name",value:"appId"}},{kind:"Field",name:{kind:"Name",value:"appName"}},{kind:"Field",name:{kind:"Name",value:"content"}},{kind:"Field",name:{kind:"Name",value:"contentType"}},{kind:"Field",name:{kind:"Name",value:"locale"}}]}},{kind:"Field",name:{kind:"Name",value:"adaptiveCardTabResult"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"appIcon"}},{kind:"Field",name:{kind:"Name",value:"appId"}},{kind:"Field",name:{kind:"Name",value:"appName"}},{kind:"Field",name:{kind:"Name",value:"content"}},{kind:"Field",name:{kind:"Name",value:"contentType"}},{kind:"Field",name:{kind:"Name",value:"locale"}}]}},{kind:"Field",name:{kind:"Name",value:"text"}},{kind:"Field",name:{kind:"Name",value:"taskModuleId"}},{kind:"Field",name:{kind:"Name",value:"draftId"}},{kind:"Field",name:{kind:"Name",value:"conversationId"}},{kind:"Field",name:{kind:"Name",value:"reason"}},{kind:"Field",name:{kind:"Name",value:"entryPoint"}}]}}]}}]}},166031:(e,t,i)=>{i.d(t,{R:()=>n});const n={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"viewImagesResult"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"viewImagesResult"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"viewImagesError"}},{kind:"Field",name:{kind:"Name",value:"errorCode"}}]}}]}}]}},979176:(e,t,i)=>{i.d(t,{kn:()=>n,uS:()=>r,U3:()=>a});const n="Layout",r={closeMonitor:"closeMonitor",collapseHeader:"collapseHeader",completeAppPhaseReached:"completeAppPhaseReached",criticalAppPhaseReached:"criticalAppPhaseReached",expandHeader:"expandHeader",expandTab:"expandTab",hideMonitor:"hideMonitor",maximizeTab:"maximizeTab",postCriticalAppPhaseReached:"postCriticalAppPhaseReached",reset:"reset",resetLayoutOverrides:"resetLayoutOverrides",resizeSlot:"resizeSlot",showMonitor:"showMonitor",unhideMonitor:"unhideMonitor",updateAmsV2Domain:"updateAmsV2Domain",updateBaseImageUrl:"updateBaseImageUrl",updateIsImageAuthCookieValid:"updateIsImageAuthCookieValid",updateMeControlAvatarSrc:"updateMeControlAvatarSrc"},a={collapseHeader:()=>({originator:n,type:r.collapseHeader}),completeAppPhaseReached:()=>({originator:n,type:r.completeAppPhaseReached}),criticalAppPhaseReached:()=>({originator:n,type:r.criticalAppPhaseReached}),expandHeader:()=>({originator:n,type:r.expandHeader}),expandTab:e=>({originator:n,type:r.expandTab,data:e}),maximizeTab:()=>({originator:n,type:r.maximizeTab}),postCriticalAppPhaseReached:()=>({originator:n,type:r.postCriticalAppPhaseReached}),resetLayoutOverrides:()=>({originator:n,type:r.resetLayoutOverrides}),resizeSlot:e=>({originator:n,type:r.resizeSlot,data:e}),updateAmsV2Domain:e=>({data:e,originator:n,type:r.updateAmsV2Domain}),updateMeControlAvatarSrc:e=>({data:e,originator:n,type:r.updateMeControlAvatarSrc}),updateBaseImageUrl:e=>({data:e,originator:n,type:r.updateBaseImageUrl}),updateIsImageAuthCookieValid:e=>({data:e,originator:n,type:r.updateIsImageAuthCookieValid}),closeMonitor:()=>({originator:n,type:r.closeMonitor}),hideMonitor:()=>({originator:n,type:r.hideMonitor}),showMonitor:e=>({originator:n,type:r.showMonitor,data:()=>Object.assign({},e)}),unhideMonitor:()=>({originator:n,type:r.unhideMonitor})}},321748:(e,t,i)=>{i.d(t,{q8:()=>c,dR:()=>u,Zl:()=>m});var n=i(850402),r=i(765923),a=i(905581),o=i(132756),s=i(738646);const d="Browser does not support IndexedDB APIs",l="Error in indexedDB open request";function c(e,t,i,c,u,m){return(0,n.__awaiter)(this,void 0,void 0,(function*(){let n;const E=(0,r.J)().indexedDB,v=new Promise(((r,v)=>{const h=u.newScenario(s.RG.IndexedDBFetch);h.appendEventData({dataSource:i});try{E||v((0,a.Tr)(o.w5.IndexDb,o.jK.IndexDbException,d)),n=E.open(e,t),n.onerror=()=>{v((0,a.Tr)(o.w5.IndexDb,o.jK.IndexDbException,l))},n.onupgradeneeded=e=>{p(t,i,c,n,e,r,v,h)},n.onsuccess=function(e,t,i,n,r,s,d){return()=>{try{const l=e.result,c=l.transaction([t]).objectStore(t),u=d?c.getAll():c.get(i);u.onsuccess=e=>{l.close(),n.stop();const t=e.target.result;r(d?t:t&&(t.value||u.result))},u.onerror=()=>{l.close(),n.fail(),s((0,a.Tr)(o.w5.IndexDb,o.jK.IndexDbException,"Error trying to get chat service sync end point from indexedDB"))}}catch(e){n.fail(),s((0,a.Tr)(o.w5.IndexDb,o.jK.IndexDbException,`Failed to read from '${t}' object store on the indexedDB.`))}}}(n,i,c,h,r,v,m)}catch(e){h.fail({errors:e.message}),v(e)}}));return v}))}function u(e,t,i,a,o){return(0,n.__awaiter)(this,void 0,void 0,(function*(){{let n;const l=(0,r.J)().indexedDB;return new Promise(((r,c)=>{const u=o.newScenario(s.RG.IndexedDBDelete);u.appendEventData({dataSource:i});try{l||c(new Error(d)),n=l.open(e,t),n.onerror=()=>{c(new Error(d)),u.fail({errors:d})},n.onsuccess=()=>{!function(e,t,i,n,r){try{const a=e.result,o=a.transaction([t],"readwrite"),s=o.objectStore(t).clear();s.onsuccess=e=>{a.close(),i.stop(),n(e.target.result)},s.onerror=e=>{a.close(),i.fail(),r(`Error trying to delete data from indexedDB: ${e}`)}}catch(e){i.fail(),r(`Error trying to delete data from indexedDB: ${e}`)}}(n,i,u,r,c)},n.onupgradeneeded=e=>{p(t,i,a,n,e,r,c,u)}}catch(e){u.fail({errors:e.message}),c(e)}}))}}))}function m(e,t,i,a,o,l){return(0,n.__awaiter)(this,void 0,void 0,(function*(){let n;const c=(0,r.J)().indexedDB,u=new Promise(((r,u)=>{const m=l.newScenario(s.RG.IndexedDBWrite);m.appendEventData({dataSource:i});try{c||u(new Error(d)),n=c.open(e,t),n.onerror=()=>{u(new Error(d)),m.fail({errors:d})},n.onsuccess=()=>{!function(e,t,i,n,r,a){try{const o=e.result,s=o.transaction([t],"readwrite").objectStore(t);let d;i.forEach((e=>{d=s.put(e),d.onsuccess=e=>{o.close(),n.stop(),r(e.target.result.value)},d.onerror=e=>{o.close(),n.fail(),a(`Error trying to write into indexedDB: ${e}`)}}))}catch(e){n.fail(),a(`Error trying to write into indexedDB: ${e}`)}}(n,i,o,m,r,u)},n.onupgradeneeded=e=>{p(t,i,a,n,e,r,u,m)}}catch(e){m.fail({errors:e.message}),u(e)}}));return u}))}function p(e,t,i,n,r,a,o,d){try{r.oldVersion<e&&n.result.createObjectStore(t,{keyPath:i}),d.mark(s.ck.IndexedDBUpgrade),a()}catch(e){d.fail(),o(`Failed to create object stores on the indexedDB: ${e}`)}}},898293:(e,t,i)=>{i.d(t,{L5:()=>o,MO:()=>s,Dj:()=>d});var n=i(850402),r=i(321748),a=i(271721);const o=(e,t,i,o)=>(0,n.__awaiter)(void 0,void 0,void 0,(function*(){var n,s;try{const a=yield null==t?void 0:t.getUser();if(!(e&&(null===(n=null==a?void 0:a.profile)||void 0===n?void 0:n.tid)&&(null===(s=null==a?void 0:a.profile)||void 0===s?void 0:s.oid)&&i))throw new Error("missing required parameters");const{databaseName:d,versionNumber:c,objectStoreName:u,objectStoreKey:m}=l(e,a.profile.tid,a.profile.oid),p=JSON.stringify(i).length;if(p>12500)throw new Error(`cart size is ${p} bytes, maximum: 12500`);yield(0,r.Zl)(d,c,u,m,[i],o)}catch(e){throw(0,a.HV)(o).fail({error:"failed to write marketplace cart in cache"}),new Error(`failed to write marketplace cart in cache, ${e.message}`)}})),s=(e,t,i)=>(0,n.__awaiter)(void 0,void 0,void 0,(function*(){var n,o;try{const a=yield null==t?void 0:t.getUser();if(!e||!(null===(n=null==a?void 0:a.profile)||void 0===n?void 0:n.tid)||!(null===(o=null==a?void 0:a.profile)||void 0===o?void 0:o.oid))throw new Error("missing required parameters");const{databaseName:s,versionNumber:d,objectStoreName:c,objectStoreKey:u}=l(e,a.profile.tid,a.profile.oid),m=yield(0,r.q8)(s,d,c,u,i,!0);return null==m?void 0:m[0]}catch(e){throw(0,a.HV)(i).fail({error:"failed to read marketplace cart in cache"}),new Error(`failed to read marketplace cart in cache, ${e.message}`)}})),d=(e,t,i)=>(0,n.__awaiter)(void 0,void 0,void 0,(function*(){var n,o;try{const a=yield null==t?void 0:t.getUser();if(!e||!(null===(n=null==a?void 0:a.profile)||void 0===n?void 0:n.tid)||!(null===(o=null==a?void 0:a.profile)||void 0===o?void 0:o.oid))throw new Error("missing required parameters");const{databaseName:s,versionNumber:d,objectStoreName:c,objectStoreKey:u}=l(e,a.profile.tid,a.profile.oid);return void(yield(0,r.dR)(s,d,c,u,i))}catch(e){throw(0,a.HV)(i).fail({error:"failed to clear marketplace cart in cache"}),new Error(`failed to clear marketplace cart in cache, ${e.message}`)}})),l=(e,t,i)=>({databaseName:`marketplace-cart:${t}:${i}`,versionNumber:1,objectStoreName:`app:${e}`,objectStoreKey:"cartInfo.market"})},74187:(e,t,i)=>{i.d(t,{zm:()=>n,py:()=>r,WK:()=>a,bW:()=>l,x$:()=>c,Zk:()=>u,OO:()=>m});var n,r,a,o,s,d=i(132756);!function(e){e.logErrorMessage="errorMessage",e.internalErrorCode="errorCode",e.correlationId="correlationId",e.httpStatusCode="httpStatusCode",e.isRecoverable="isRecoverable",e.reportingService="reportingService",e.subError="subError",e.serviceErrorMessage="serviceErrorMessage",e.cmdRequestId="requestId"}(n||(n={})),function(e){e.UNKNOWN_ERROR="UnknownError",e.FORBIDDEN="Forbidden",e.NOT_FOUND="NotFound",e.CONFLICT="Conflict",e.UNAUTHORIZED="Unauthorized",e.BAD_REQUEST="BadRequest",e.INTERNAL_SERVER_ERROR="InternalServerError",e.SERVICE_UNAVAILABLE="ServiceUnavailable",e.REQUEST_THROTTLED="RequestThrottled",e.FAILED_TO_CALL_SCHEDULING_SERVICE="FailedToCallSchedulingService",e.GATEWAY_TIMEOUT="GatewayTimeout",e[e.DEFAULT_ERROR=1e3]="DEFAULT_ERROR",e[e.BEGIN_CLIENT_ERROR_CODES=1001]="BEGIN_CLIENT_ERROR_CODES",e[e.INVALID_RESPONSE=1002]="INVALID_RESPONSE",e[e.CHANGE_KEY_NOT_FOUND=1003]="CHANGE_KEY_NOT_FOUND",e[e.EMPTY_INPUT=1004]="EMPTY_INPUT",e[e.INVALID_SECRET=1005]="INVALID_SECRET",e[e.RENEW_TOKEN_FAILED=1006]="RENEW_TOKEN_FAILED"}(r||(r={})),function(e){e.DEFAULT_BAD_REQUEST="Request is not correct, please ensure you are passing the values for each parameter.",e.DEFAULT_ERROR="Unknown error occurred",e.COLLAB_OBJECT_NOT_FOUND="Collab object could not be found for the provided external entity key",e.RESOURCE_CONFLICT="Resource conflicts with another; location URLs must be unique",e.EMPTY_INPUT="Input is empty",e.INVALID_SECRET="Invalid Secret while trying to commit resource",e.FORBIDDEN="User does not have permissions to access the requested resource",e.INVALID_RESPONSE="Response from CMD Artifact service is not valid.",e.CHANGE_KEY_NOT_FOUND="No change key in collab object returned.",e.UNAUTHORIZED="User does not have permissions to perform the requested action",e.INTERNAL_SERVER_ERROR="An error occurred with Artifacts service",e.SERVICE_UNAVAILABLE="Service is not currently available.",e.REQUEST_THROTTLED="Requests to the artifacts service are being throttled.",e.FAILED_TO_CALL_SCHEDULING_SERVICE="Artifact service was not able to call scheduling service",e.GATEWAY_TIMEOUT="A downstream service is timing out."}(a||(a={})),function(e){e.RESOURCE_CONFLICT="Conflict - Reason: Conflict",e.BAD_REQUEST="Bad Request",e.NOT_FOUND="NotFound - Reason: Not Found",e.FORBIDDEN="Permission Issue"}(o||(o={})),function(e){e.POPUP_BLOCKED="Error opening popup",e.RENEW_TOKEN_FAILED="Token Renewal Failed"}(s||(s={}));const l="Unknown",c="None",u="None",m=(new Map([[s.POPUP_BLOCKED,d.jK.AuthPopupWindowBlocked],[s.RENEW_TOKEN_FAILED,r.RENEW_TOKEN_FAILED]]),new Map([[r.UNKNOWN_ERROR,a.DEFAULT_ERROR],[r.CONFLICT,a.RESOURCE_CONFLICT],[r.NOT_FOUND,a.COLLAB_OBJECT_NOT_FOUND],[r.BAD_REQUEST,a.DEFAULT_BAD_REQUEST],[r.FORBIDDEN,a.FORBIDDEN],[r.UNAUTHORIZED,a.UNAUTHORIZED],[r.INTERNAL_SERVER_ERROR,a.INTERNAL_SERVER_ERROR],[r.SERVICE_UNAVAILABLE,a.SERVICE_UNAVAILABLE],[r.REQUEST_THROTTLED,a.REQUEST_THROTTLED],[r.INVALID_RESPONSE,a.INVALID_RESPONSE],[r.CHANGE_KEY_NOT_FOUND,a.CHANGE_KEY_NOT_FOUND],[r.FAILED_TO_CALL_SCHEDULING_SERVICE,a.FAILED_TO_CALL_SCHEDULING_SERVICE],[r.GATEWAY_TIMEOUT,a.GATEWAY_TIMEOUT]]))},671168:(e,t,i)=>{i.d(t,{Hk:()=>o,Rd:()=>s,By:()=>d});var n=i(850402);const r=200;function a(e,t){if(!e.startsWith("blob"))return Promise.reject("invalid blob url");const i=new XMLHttpRequest;return i.open("GET",e,!0),i.responseType=t,new Promise(((e,t)=>{i.onload=()=>{i.status===r&&i.response?e(i.response):t(i.status!==r?{status:i.status,statusText:i.statusText}:{status:404,statusText:"no response data"})},i.onerror=()=>{t({status:i.status,statusText:i.statusText})},i.send()}))}function o(e){return(0,n.__awaiter)(this,void 0,void 0,(function*(){return yield a(e,"blob")}))}function s(e){return(0,n.__awaiter)(this,void 0,void 0,(function*(){const t=yield a(e,"arraybuffer");return new Uint8Array(t)}))}function d(e){return(0,n.__awaiter)(this,void 0,void 0,(function*(){return e.then((e=>URL.createObjectURL(e)))}))}},271721:(e,t,i)=>{i.d(t,{HV:()=>a,jC:()=>o});var n=i(663945),r=i(738646);const a=(e,t=!1)=>{let i=null;return t||(i=e.findScenario(r.RG.MarketplaceDeviceStoreCartControl)),i||(i=e.newScenario(r.RG.MarketplaceDeviceStoreCartControl,{startTime:(new Date).getTime()}),t||i.appendEventData({scenarioNotFound:!0})),i},o=(e,t,i)=>{const r=i();r.orderTotalPrice=(e=>{let t=0;return null==e||e.cartItems.forEach((e=>{t+=e.price*e.quantity})),t})(e);t({actionScenario:n.Tk.storeCheckoutClick,actionScenarioType:n.Yu.store,moduleName:n.rA.storeCheckoutButton,moduleType:n.PO.button,actionGesture:n.uS.click,actionOutcome:n.$K.completeCheckout,panelRegion:n.Ai.modal,panelType:n.wh.DeviceStoreCart,extensibilityData:void 0,dataBag:r}),r.dispose()}},778161:(e,t,i)=>{i.d(t,{P:()=>r});var n=i(375823);function r(e){const t=e.performance;let i,r,a;const o=null==t?void 0:t.memory;return o&&(i=(0,n.kl)(o.jsHeapSizeLimit),r=(0,n.kl)(o.totalJSHeapSize),a=(0,n.kl)(o.usedJSHeapSize)),{jsHeapSizeLimit:i,totalJSHeapSize:r,usedJSHeapSize:a}}},422325:(e,t,i)=>{i.d(t,{K:()=>o});var n=i(850402),r=i(375823);const a="heartbeat";function o(e,t){return(0,n.__awaiter)(this,void 0,void 0,(function*(){const i={workers:[],processes:[],windows:[]},n=yield null==e?void 0:e.loadModule(a);if(!(null==n?void 0:n.getPerfMetrics))return i;try{let e;if(t&&(null==n?void 0:n.getPerfMetricsAsync)){const t=yield n.getPerfMetricsAsync();e=t.processes,i.windows=t.windows;for(const e of t.workers)i.workers.push({targetSessionId:e.targetSessionId,type:e.type,subType:e.subType,totalSizeKB:(0,r.kl)(e.totalSizeBytes),usedSizeKB:(0,r.kl)(e.usedSizeBytes)})}else e=yield n.getPerfMetrics();for(const t of e)i.processes.push({processId:t.processId,name:t.name,type:t.type,utilitySubType:t.utilitySubType,embeddedBrowserWebView:t.embeddedBrowserWebView,cpuCycleTime:t.cpuCycleTime,workingSetSizeKB:(0,r.kl)(t.workingSetSizeBytes),commitSizeKB:(0,r.kl)(t.pageFileUsageBytes)})}catch(e){console.error("get-webview-2-metrics, getMetrics: Failed to get metrics.")}return i}))}},375823:(e,t,i)=>{i.d(t,{tC:()=>a,Mv:()=>o,RQ:()=>s,kl:()=>d,ev:()=>l});var n=i(275742);const r=1024;function a(e){const t={},i=[...e];return p(t,"TelemetryWorker",_(i,"TelemetryWorker")),p(t,"CDLWorker",_(i,"CDLWorker")),p(t,"ServiceWorker",_(i,"ServiceWorker")),t.Perf_Total_NumberOfCDLWorkers=S(e,"CDLWorker"),t.Perf_Total_NumberOfServiceWorkers=S(e,"ServiceWorker"),t.Perf_Total_NumberOfTelemetryWorkers=S(e,"TelemetryWorker"),t.Perf_Total_NumberOfWorkers=e.length,t}function o(e,t,i){const n={},r=[...e];E(n,"GPU",h(r,["gpu-process","Gpu"]),t),E(n,"NativeShell",h(r,["nativeShell","NativeShell"]),t),E(n,"CrashpadHandler",h(r,"crashpad-handler"),t),E(n,"Browser",h(r,["browser","Browser"]),t);const a=h(r,["renderer","Renderer"]);n.Perf_Renderer_Count_Processes=a.length,E(n,"Renderer",a,t),E(n,"SlimCore",h(r,["NativeModuleProcess_SlimCore"]),t);const o=h(r,["utility","Utility"]);if(E(n,"Utility",o,t),n.Perf_Utility_Process=[...o],f(n,"NetworkService",g(o,"NetworkService")),f(n,"StorageService",g(o,"StorageService")),f(n,"AudioService",g(o,"AudioService")),E(n,"Total",e),n.Perf_Total_NumberOfProcesses=e.length,n.Perf_Unknown_Process=r,n.Perf_Unknown_NumberOfProcesses=r.length,n.Perf_Unknown_WorkingSet=u(r),n.Perf_Unknown_CommitSize=m(r),i){const r=e.find((e=>e.processId===i));r&&(n.Perf_MainRenderer_WorkingSet=u([r]),n.Perf_MainRenderer_CommitSize=m([r]),n.Perf_MainRenderer_PeakWorkingSet=null==t?void 0:t.get(i))}return n}function s(e,t){const i={},{totalJSHeapSize:n,jsHeapSizeLimit:r,usedJSHeapSize:a}=e;return n&&(i.Perf_JSHeap_TotalSize=n),r&&(i.Perf_JSHeap_LimitSize=r),a&&(i.Perf_JSHeap_UsedSize=a),t&&(i.Perf_Peak_UsedJSHeapSize=t),i}function d(e){return"number"!=typeof e||isNaN(e)?void 0:Math.round(e/r)}const l=d;function c(e,t){const i=(0,n.sumBy)(e,(e=>{var i;return null!==(i=e[t])&&void 0!==i?i:NaN}));return 0===e.length||isNaN(i)?void 0:i}function u(e){return c(e,"workingSetSizeKB")}function m(e){return c(e,"commitSizeKB")}function p(e,t,i){e[`Perf_${t}_UsedSize`]=function(e){return c(e,"usedSizeKB")}(i),e[`Perf_${t}_TotalSize`]=function(e){return c(e,"totalSizeKB")}(i)}function E(e,t,i,n){if(e[`Perf_${t}_WorkingSet`]=u(i),e[`Perf_${t}_CommitSize`]=m(i),"Total"===t)e.Perf_Total_NumberOfProcesses=i.length;else{if(e[`Perf_${t}_Count_Processes`]=i.length,!n||!i.length)return;const r=Math.max(...i.map((e=>n.get(e.processId)||0)));r&&(e[`Perf_${t}_PeakWorkingSet`]=r)}}function v(e,t){let i;const n=[];for(;i=e.findIndex(t),-1!==i;)n.push(e.splice(i,1)[0]);return n}function h(e,t){const i="string"==typeof t?[t]:t;return v(e,(e=>i.includes(e.type)))}const S=(e,t)=>e.filter((e=>e.subType===t)).length;function _(e,t){return v(e,(e=>e.subType.includes(t)))}function g(e,t){return v(e,(e=>e.utilitySubType.includes(t)))}function f(e,t,i){e[`Perf_${t}_WorkingSet`]=u(i),e[`Perf_${t}_CommitSize`]=m(i),e[`Perf_${t}_Count_Processes`]=i.length}}}]);